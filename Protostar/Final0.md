# Final Zero Writeup

# `Source Code`

![source code](img/final/final0_source_code.png)

Daha önce ayrı ayrı uygulamış olduğumuz `stack overflow` ve `network programming` konularından faydalanarak `remote buffer overflow` zafiyetinden faydalanmamız beklenmekte.

root kullanıcısına geçiş yaptıktan sonra `netstat -plant` sonra `final0` programımızın çalıştığı portu `2995` olarak buluyoruz.

![0](img/final/final0_0.png)

Soruda `512` karakterlik bir `buffer`ımız var. `buffer`ı taşırıp `eip` üzerine yazmamız gerekiyor. Bunun için `buffer`ı taşırdıktan sonra kaç karaktere daha ihtiyacımız var onu öğrenelim.

    echo `python -c "print 'A'*512+'BBBB'+'CCCC'+'DDDD'+'EEEE'+'FFFF'+'GGGG'"` | nc 127.0.0.1 2995

    dmesg | tail -1    

![1](img/final/final0_1.png)

`0x47` => `G` . Ve `532` karakterden sonra `eip` üzerine yazabileceğimizi görmüş olduk.

Ufaktan exploitimiz yazmaya başlayalım...

![2](img/final/final0_2.png)

NOT : Burada iki farklı yol var. Dilerseniz direk `shellcode` çalıştırabilir veya `ret2libc` saldırısını kullanabilirsiniz

Ben `ret2libc` üzerinden anlatacağım.

Önce `libc system` adresini bulalım.

    (gdb) p system

![3](img/final/final0_3.png)

Daha sonra `/bin/sh` adresini bulalım

    gdb final0
    break *main
    run
    info proc map

**


![4](img/final/final0_4.png)

    strings -a -t x /lib/libc-2.11.2.so | grep "/bin/sh"

![5](img/final/final0_5.png)

Şimdi bu iki değeri toplayalım

    (gdb) x/s 0xb7e97000+0x11f3bf

![6](img/final/final0_6.png)

`/bin/sh` adresimizi de bulduğumuza göre artık bulduğumuz değerleri exploitimize ekleyebiliriz.

![7](img/final/final0_7.png)

Test edelim bakalım çalışıyor mu ?

![8](img/final/final0_8.png)

Evet lokalde çalıştığına göre artık uzaktan da çalıştırabiliyor muyuz diye bir bakalım

![9](img/final/final0_9.png)

Ve gördüğünüz gibi root olarak uzaktan komut çalıştırabildik. (ifconfig veya ip addr show komutunu kullanarak makinenizin ip adresini öğrenebilirsiniz)

Ama burada exploitimiz dinamik olarak çalışmıyor. Sadece önceden belirlemiş komutlar çalışıyor. Hadi bir de bu exploitimizi dinamik hale getirelim.

![exploit](img/final/final0_exploit.png)

Uzaktan root olarak komut çalıştırmamıza olanak sağlayan exploitimiz başarılı bir şekilde çalışmış oldu :)
